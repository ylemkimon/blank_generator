var examples = {
	1: 'Too many of us think of poetry only as a private, published experience, but poetry is also a public art, and this has never been more true than during our own time. Poets have always given public readings of their work, but ever since the 1950s, poetry has increasingly occupied a public stage, and today we are surrounded by public poetry, poetry presented in its oral form, and not just in popular songs or rap and hip hop music. Today, many people participate in such events as poetry slams. A poetry slam, for instance, is essentially a poetry competition that emphasizes both the writing of poetry and its performance. In a poetry slam, poets perform their work and are judged by the audience based on the poet’s performance and the work’s content. These events have become highly popular among high school and college students, in small towns and large cities, and through popular online forums.',
	2: 'Most often, readers create mental images by retrieving pictures that are already stored in their memory. In other words, they make a connection with something they have seen or know about and that is what helps them to create the image. It is more challenging to visualize things we have not personally experienced. This all happens in an instant, but if we were to slow it down, we might see it as similar to searching through archives of photo files to find a specific photo. Our brains search through our files until we find an image we can use to support the text we are reading. When a reader has no specific experience or memory from which to draw, imagination can often support visualizing. Readers who were first introduced to Hogwarts School of Witchcraft and Wizardry, for example, had never personally experienced it; however, J.K. Rowling’s rich descriptions helped us all to “see” it with our imaginations.',
	3: 'When we are dealing with complex, interesting presentations of ideas, variations in understanding are quite normal and sometimes are even welcomed: how otherwise could there be new interpretations of Shakespeare’s plays, and why else are we interested in them? I am sure that my understanding of Pinker’s book, despite the clarity of his writing, will not be exactly what he might have intended or expected, and I know that I will not make quite the same interpretation of it as other readers. I expect that many authors are frequently disappointed to discover that readers misunderstand their ‘message,’ but they should not necessarily take this as failure on their part. The act of reading any text relies on the interpretative efforts of a reader, as well as on the communicative efforts and intentions of the author.',
	4: 'The appearance of language, some time long ago in the prehistory of our species, made possible the kind of social existence which we take for granted. It gave us a crucial evolutionary advantage over other animals, partly because it became possible for us to share useful information with a new clarity and explicitness, within and across generations. Through the evolution of language, we also became capable of thinking constructively and rationally together. Other relatively intelligent species (such as chimpanzees and dolphins) have never developed comparable ways of sharing their mental resources, with the result that each individual animal can only learn from others by observation, imitation and taking part in joint activity; and most of the knowledge each chimpanzee or dolphin accumulates over a lifetime is lost when they die.',
	5: 'Congestion--which basically consists of waiting in line--is the nation’s principal means of allocating scarce road space among competing users during periods when too many people want to use that limited space at the same time. That “excess demand” for roadways during peak hours is the real problem, to which congestion is the most practicable solution. The problem of excess demand arises because modern society is organized in such a way as to generate the need for far more people to travel during certain limited times of the day than any practicable road system can handle then at maximum flow speeds. Society cannot eliminate the resulting “excess demand” for travel during these peak hours without fundamentally reorganizing the entire economy and all our schools in ways that are totally unacceptable to most people.',
	6: 'One of the most common types of entertainment programming on television involves high levels of violence. Violence also finds its way into advertising. It may surprise you, however, that violent TV programming actually reduces memory for the commercials in those shows and reduces the chance that people will intend to buy those products. In attempting to explain this finding, Bushman suggests one reason may be that watching violence raises one’s physiological arousal by making people angry and putting them in a bad mood. An angry mood can prime aggressive thoughts, which in turn may interfere with recall of the ad content. Negative moods are known to interfere with the brain’s encoding of information. Also, the effort taken to try to repair the bad mood may distract one from attending to and processing the ad. Thus, it may be that advertisers are not getting as much “bang for their buck” with violent content as with nonviolent content.',
	7: 'In the less hierarchical and less bounded networked environment--where special knowledge is more in dispute than in the past and where relationships are less stable--there is more uncertainty about whom and what information sources to trust. The explosion of information and information sources has had the paradoxical impact of pushing people on the path of greater reliance on their networks. It might seem that the abundance of information that organizations provide on the Internet would prompt people to rely less on their friends and colleagues for facts and advice. Yet it turns out that the increasing amount of information pouring into people’s lives leads them to turn to their social networks to make sense of it. The result is that as people gather information to help them make choices, they cycle back and forth between Internet searches and discussion with the members of their social networks, using in-person conversations, phone chats, and emails to exchange opinions and weigh options.',
	8: 'Open source software projects have two key attributes. First, the code is made publicly available, so anyone can experiment with and modify the code, not just the original programmer. Second, other people are encouraged to contribute improvements to the code. This might mean sending in a bug report when something goes wrong, or perhaps suggesting a change to a single line of code, or even writing a major code module containing thousands of lines of code. The most successful open source projects recruit large numbers of contributors, who together can develop software far more complex than any individual programmer could develop on their own. To give you some idea of the scale, in 2007 and 2008 Linux developers added an average of 4,300 lines of code per day to the Linux kernel, deleted 1,800 lines, and modified 1,500 lines. That’s an astonishing rate of change--on a large software project, an experienced developer will typically write a few thousand lines of code per year.',
	9: 'Beginning in about first grade, clothing becomes a vehicle by which children accomplish one of childhood’s most important developmental tasks: connecting with peers. At this age, wanting to wear what a best friend wears is not about label consciousness or status symbols (wait a few years!) but about making friends. The first-grader who wants sneakers just like Tommy’s probably wants them because Tommy runs really fast and he wants to run as fast as Tommy so Tommy will like him. The second-grader is so admiring of the girl in her class who is reading chapter books that she wants to dress like her. Two third-grade girls who exchange one sock are using the mismatch to strengthen their status as best friends. A group of five fourth-grade boys who play together at break times every day wear neon shoelaces to show their friendship.',
	10: 'One of the great strengths of parents of an only child is their supervision of detail. With multiple children, much can escape parental notice. In addition, some parental resolves are not consistently applied, some good intentions are not carried through, and some requirements are not uniformly enforced, because when managing so many children some slippage is bound to occur. Parents just can’t keep up with three children as closely as they can with one. Under undistracted parental focus, however, the only child can feel constantly under a microscope, sometimes wishing there was another child in the family to direct parental attention elsewhere. “Some only children find the focus of attention almost overwhelming.”',
	11: 'Empathy could be a highly generalized characteristic in that people who are empathic toward animals would be more likely to be empathic toward people. This makes sense if we assume that many of the processes underlying empathy (a living creature is involved, distress cues can be perceived and correctly identified, relieving the distress of another is a valued trait) are applicable to both people and animals. Unfortunately, a lack of empathy may also be a general characteristic of some people; little concern or care is shown toward victims of distress, human or animal. There is also the possibility that empathy is more specific. Some people may be highly empathic toward the suffering of other human beings but insensible to or unconcerned with animal distress. The opposite may also occur in cases where a person has great affection and empathy for animals but cares little for the concerns and welfare of other people.',
	12: 'People differ in the number of attributes, memories, and self-schemas that are part of their self-concept. Some people have highly complex selves and others much less complex. Self-complexity is important in influencing how people react to the good and bad events in life. Someone who is, say, an engineer, an opera lover, a mother, and an artist can absorb a blow to one of her selves without much damage to her overall self-concept. If her latest artistic efforts meet unfavorable reviews, this woman’s sense of self is buffered by the fact that there is much more to her than being an artist. She is still a mother, an engineer, an opera lover, and much more. People who are low in self-complexity may be deeply shocked by negative events, because there is little else to act as a buffer.',
	13: 'Those living and working in areas with high levels of rural tourism are undoubtedly affected in many ways. Areas with high visitor figures tend to see an increase in the cost of homes (as many are bought as second homes, retirement properties and holiday cottages), making it increasingly difficult for those born and raised in the area to continue to live there. The average house price in these areas is driven up and those buying second homes and retirement properties have a higher disposable income. The area becomes more desirable and as a result house prices climb, leaving local people unable to buy a house in these areas. This results in an ageing population and an increase in the number of older people moving into the area. This has resulted in a public sector drive to encourage and support local business start-ups to improve opportunities for younger generations to stay in the local area, rather than move away to find cheaper homes and lower living costs.',
	14: 'Life in the high Andes is certainly not easy for anyone, and it is especially hard on the youngest members of society. Nevertheless, children assume good behavior, becoming well-adjusted and helpful while enjoying whatever life can offer. They are grateful for anything they get. The key to such positive socialization is twofold. The fact that adults are models at home and within the community and children have plenty of opportunities to observe their behavior is paramount. Furthermore, this society’s beliefs and behavior patterns reinforce respect and compassion for all life. Thus, children are not caught in a moral conflict of deciding which aspects of life deserve respect and reciprocity and which do not. Children learn to respect life in all its forms.',
	15: 'One critical finding is that most organizations do not know how to secure their assets, including intellectual assets, during times of crisis. As a result, many organizations lose their most valuable intellectual assets during times of greatest crisis. This results in the inability of the organization to recover from crisis events. Consider the following: if an organization does not have people to help rebuild the organization after an event, no amount of financial reserves will help. Moreover, simply having the ability to hire new staff is not sufficient, as it is the knowledge in and around people that keeps an organization afloat. This is not easily replaced, especially during times of high stress. Securing knowledge before and during a crisis and mobilizing knowledge during the recovery period are important issues which cannot be left to wishful thinking.',
	16: 'In law, only a tiny group of thinkers has actively pursued a fairly extreme line of argument: that we should formally recognise our commonality with other animals and, therefore, have animals legally reclassified. Their dramatic aim is to shift at least some animal species into the rights-bearing, and so human, category, and thus alter the conceptual relationship between humans and other animals. But mainly this heroic attempt to reclassify the natural world, and our place within it, is seen as strange and misguided; to many jurists, probably the majority, it does not call for serious intellectual engagement. The relatively uncontroversial view is that animals should remain a reasonably well-protected form of property (they are protected by a range of animal welfare laws) and all human beings should remain persons.'
};

var blanks = {
	1: [],
	2: [],
	3: [],
	4: [],
	5: [],
	6: [],
	7: [],
	8: [],
	9: [],
	10: [],
	11: [],
	12: [],
	13: [],
	14: [],
	15: [],
	16: []
}

var clozeTest = new Ractive({
	el: '#clozeTest',
	template: '#template-clozeTest',

	data: {
		input: '여기에 입력하세요...'
	},

	computed: {
		inputRegex: function() {
			var input = this.get('input');
			return input.replace(/([_0-9a-zA-Z\uac00-\ud7a3]+)/g,'<span>$1</span>').replace(/\n/g,'<br/>');
		}
	}

});

for (j = 1; j <= 16; j++) {
	var num = '' + j;
	clozeTest.on(num, function() {
		console.log($(this));
		clozeTest.set('input', examples[num]);
		for (i = 0; i < blanks[num].length; i++) {
			$('#result_content').children()[blanks[num][i]].click();
		}
	});
}

//Randomise plugin
(function($) {
	$.fn.randomize = function(childElem) {
		return this.each(function() {
			var $this = $(this);
			var elems = $this.children(childElem);

			elems.sort(function() { return (Math.round(Math.random())-0.5); });

			$this.remove(childElem);

			for(var i=0; i < elems.length; i++){
				$this.append(elems[i]);
			}
		});
	}
})(jQuery);

$(function() {

	//Increment number
	var number = 0;
	function incrementNumber () {
		if (number == 0) {
			$('#input').attr("disabled", true);
		}
		number += 1;
	}
	
	var numbers = [];

	$('body').on('click', '#result_content span', function(){
		var
			thisTxt = $(this).text(),
			inputWidth = $(this).width()
		;
		if ($(this).children().length == 0) {
			numbers.push($('#result_content').children().index($(this)));
			incrementNumber();

			$(this).attr({id: 'item' + number})
				.addClass('selected')
				.clone()
				.text($(this).text() + ' ')
				.appendTo('#keyword_content')
			;

			$(this).html('(' + number + ') <input type="text"/>')
				.find('input')
				.addClass('test-input')
				.attr({name: thisTxt})
				.css('width', inputWidth)
				.data('text', thisTxt)
			;
		}
	});
	
	$('body').on('click','#keyword_content span', function() {
		var thisClass = $(this).attr('id');
		var thatClass = 'span#' + thisClass;
		var thisTxt = $(this).text().trim();
		$('#result_content').find(thatClass).replaceWith('<span>' + thisTxt + '</span>');
		$(this).fadeOut('slow').remove();
	});

	$('#keywords button').click(function() {
		//$('#keyword_content').randomize("#keyword_content span");
		console.log(numbers.sort(function(a,b){return a-b;}));
	});

	$('body').on('keyup', '#result_content input[type=text]', inputCheck);

	function inputCheck() {
		if ( this.value === this.name ) {
			$(this).addClass('success');
			$(this).parent().addClass('success').text(this.name);
			var inputs = $('#result_content').find(':input');
			inputs.eq(inputs.index(this)+ 1).focus();
			$(this).remove();
		} else {
			$(this).addClass('error');
		}
	}

});
